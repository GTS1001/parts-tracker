<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>Parts Tracker</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.5/babel.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #f5f5f5;
            -webkit-font-smoothing: antialiased;
        }
        
        #root {
            max-width: 480px;
            margin: 0 auto;
            background: white;
            min-height: 100vh;
            box-shadow: 0 0 20px rgba(0,0,0,0.1);
        }
        
        .header {
            background: #2563eb;
            color: white;
            padding: 20px;
            text-align: center;
            font-size: 22px;
            font-weight: bold;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .content {
            padding: 20px;
        }
        
        .btn {
            width: 100%;
            padding: 18px;
            border: none;
            border-radius: 12px;
            font-size: 17px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .btn:active {
            transform: scale(0.98);
        }
        
        .btn-primary {
            background: #2563eb;
            color: white;
        }
        
        .btn-success {
            background: #16a34a;
            color: white;
        }
        
        .btn-danger {
            background: #dc2626;
            color: white;
        }
        
        .btn-light {
            background: #e5e7eb;
            color: #374151;
        }
        
        .btn:disabled {
            background: #d1d5db;
            cursor: not-allowed;
            opacity: 0.6;
        }
        
        .btn-group {
            display: flex;
            flex-direction: column;
            gap: 12px;
            margin-top: 20px;
        }
        
        .photo-area {
            border: 3px dashed #d1d5db;
            border-radius: 12px;
            min-height: 200px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: #f9fafb;
            cursor: pointer;
            margin-bottom: 24px;
            overflow: hidden;
            position: relative;
        }
        
        .photo-placeholder {
            text-align: center;
            color: #6b7280;
        }
        
        .photo-placeholder svg {
            width: 64px;
            height: 64px;
            margin-bottom: 8px;
        }
        
        .photo-preview {
            width: 100%;
            height: auto;
            display: block;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-group label {
            display: block;
            font-weight: 600;
            margin-bottom: 8px;
            color: #374151;
            font-size: 15px;
        }
        
        .form-group select,
        .form-group input {
            width: 100%;
            padding: 14px;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            font-size: 16px;
            background: white;
        }
        
        .form-group select:focus,
        .form-group input:focus {
            outline: none;
            border-color: #2563eb;
        }
        
        .number-display {
            background: #f0f9ff;
            border: 3px solid #2563eb;
            border-radius: 12px;
            padding: 32px;
            text-align: center;
            margin: 24px 0;
        }
        
        .number-display .label {
            font-size: 14px;
            color: #6b7280;
            margin-bottom: 8px;
        }
        
        .number-display .number {
            font-size: 48px;
            font-weight: bold;
            color: #2563eb;
            font-family: 'Courier New', monospace;
        }
        
        .detail-card {
            background: #f9fafb;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
        }
        
        .detail-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 12px;
            padding-bottom: 12px;
            border-bottom: 1px solid #e5e7eb;
        }
        
        .detail-row:last-child {
            margin-bottom: 0;
            padding-bottom: 0;
            border-bottom: none;
        }
        
        .detail-row .label {
            color: #6b7280;
            font-weight: 500;
        }
        
        .detail-row .value {
            font-weight: 600;
            color: #1f2937;
        }
        
        .search-container {
            margin-bottom: 24px;
        }
        
        .search-input {
            width: 100%;
            padding: 16px;
            border: 2px solid #e5e7eb;
            border-radius: 12px;
            font-size: 18px;
            font-family: 'Courier New', monospace;
            text-align: center;
        }
        
        .search-input:focus {
            outline: none;
            border-color: #2563eb;
        }
        
        .success-check {
            width: 80px;
            height: 80px;
            background: #16a34a;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 20px;
        }
        
        .success-check svg {
            width: 48px;
            height: 48px;
            color: white;
        }
        
        .manage-list {
            margin-bottom: 20px;
        }
        
        .manage-item {
            display: flex;
            align-items: center;
            padding: 16px;
            background: white;
            border: 2px solid #e5e7eb;
            border-radius: 12px;
            margin-bottom: 12px;
        }
        
        .manage-item .name {
            flex: 1;
            font-weight: 600;
            color: #1f2937;
        }
        
        .manage-item .count {
            color: #6b7280;
            margin-right: 12px;
            font-size: 14px;
        }
        
        .manage-item svg {
            width: 20px;
            height: 20px;
            color: #6b7280;
        }
        
        .issue-list {
            margin-bottom: 20px;
        }
        
        .issue-item {
            display: flex;
            align-items: center;
            padding: 14px;
            background: white;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            margin-bottom: 8px;
        }
        
        .issue-item .text {
            flex: 1;
            color: #1f2937;
        }
        
        .issue-item button {
            background: none;
            border: none;
            color: #dc2626;
            cursor: pointer;
            padding: 8px;
        }
        
        .add-issue-form {
            display: flex;
            gap: 8px;
            margin-bottom: 20px;
        }
        
        .add-issue-form input {
            flex: 1;
            padding: 12px;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            font-size: 15px;
        }
        
        .add-issue-form button {
            padding: 12px 20px;
            background: #2563eb;
            color: white;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
        }

        .number-preview {
            background: #f0f9ff;
            border: 2px solid #2563eb;
            border-radius: 8px;
            padding: 16px;
            text-align: center;
            margin-bottom: 20px;
        }

        .number-preview .label {
            font-size: 13px;
            color: #6b7280;
            margin-bottom: 4px;
        }

        .number-preview .number {
            font-size: 32px;
            font-weight: bold;
            color: #2563eb;
            font-family: 'Courier New', monospace;
        }

        input[type="file"] {
            display: none;
        }

        .empty-state {
            text-align: center;
            padding: 40px 20px;
            color: #6b7280;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        // Default item types and issues
        const defaultItemTypes = {
            'TV': ['Broken screen', 'No power', 'No picture - has sound', 'No sound - has picture', 'Cracked panel'],
            'Washer': ['Won\'t spin', 'Won\'t drain', 'Leaking', 'Won\'t fill', 'Door won\'t lock'],
            'Dryer': ['Won\'t heat', 'Won\'t tumble', 'Too hot', 'Noisy bearing', 'Door won\'t close'],
            'Refrigerator': ['Not cooling', 'Freezer not working', 'Leaking water', 'Ice maker broken', 'Noisy compressor'],
            'Dishwasher': ['Won\'t drain', 'Won\'t fill', 'Not cleaning', 'Door latch broken', 'Not drying'],
            'Microwave': ['No heat', 'Turntable broken', 'Door switch broken', 'Sparking', 'Control panel dead'],
            'Printer': ['Paper jam', 'Won\'t print', 'Poor print quality', 'Scanner broken', 'Network issue'],
            'Monitor': ['No display', 'Cracked screen', 'Dead pixels', 'Backlight issue', 'No power']
        };

        function App() {
            const [screen, setScreen] = useState('home');
            const [entries, setEntries] = useState([]);
            const [itemTypes, setItemTypes] = useState(defaultItemTypes);
            const [nextNumber, setNextNumber] = useState(1);
            const [currentEntry, setCurrentEntry] = useState(null);
            const [selectedType, setSelectedType] = useState('');
            const [selectedIssue, setSelectedIssue] = useState('');
            const [photo, setPhoto] = useState(null);
            const [searchNumber, setSearchNumber] = useState('');
            const [editingType, setEditingType] = useState('');
            const [newIssue, setNewIssue] = useState('');
            const [entryNumber, setEntryNumber] = useState('');
            const [customIssue, setCustomIssue] = useState('');

            // Load data from memory on mount
            useEffect(() => {
                const savedEntries = localStorage.getItem('entries');
                const savedItemTypes = localStorage.getItem('itemTypes');
                const savedNextNumber = localStorage.getItem('nextNumber');
                
                if (savedEntries) setEntries(JSON.parse(savedEntries));
                if (savedItemTypes) setItemTypes(JSON.parse(savedItemTypes));
                if (savedNextNumber) setNextNumber(parseInt(savedNextNumber));
            }, []);

            // Save data to memory whenever it changes
            useEffect(() => {
                localStorage.setItem('entries', JSON.stringify(entries));
            }, [entries]);

            useEffect(() => {
                localStorage.setItem('itemTypes', JSON.stringify(itemTypes));
            }, [itemTypes]);

            useEffect(() => {
                localStorage.setItem('nextNumber', nextNumber.toString());
            }, [nextNumber]);

            // Generate number when starting new entry
            useEffect(() => {
                if (screen === 'new' && !entryNumber) {
                    setEntryNumber(nextNumber.toString().padStart(4, '0'));
                }
            }, [screen, nextNumber, entryNumber]);

            const handlePhotoCapture = (e) => {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = (event) => {
                        setPhoto(event.target.result);
                    };
                    reader.readAsDataURL(file);
                }
            };

            const handleCreateEntry = () => {
                const finalIssue = selectedIssue === 'OTHER' ? customIssue : selectedIssue;
                const newEntry = {
                    number: entryNumber,
                    itemType: selectedType,
                    issue: finalIssue,
                    photo,
                    createdAt: new Date().toISOString()
                };
                
                setEntries([...entries, newEntry]);
                setCurrentEntry(newEntry);
                setNextNumber(nextNumber + 1);
                setScreen('created');
            };

            const handleSearch = () => {
                const found = entries.find(e => e.number === searchNumber.padStart(4, '0'));
                if (found) {
                    setCurrentEntry(found);
                    setScreen('detail');
                } else {
                    alert('Entry not found. Please check the number and try again.');
                }
            };

            const handleDelete = () => {
                const numberToDelete = currentEntry.number;
                const updatedEntries = entries.filter(e => e.number !== numberToDelete);
                setEntries(updatedEntries);
                setCurrentEntry(null);
                setScreen('home');
            };

            const handleAddIssue = () => {
                if (newIssue.trim() && editingType) {
                    setItemTypes({
                        ...itemTypes,
                        [editingType]: [...itemTypes[editingType], newIssue.trim()]
                    });
                    setNewIssue('');
                }
            };

            const handleDeleteIssue = (type, issue) => {
                if (confirm(`Delete "${issue}"?`)) {
                    setItemTypes({
                        ...itemTypes,
                        [type]: itemTypes[type].filter(i => i !== issue)
                    });
                }
            };

            const resetNewEntry = () => {
                setPhoto(null);
                setSelectedType('');
                setSelectedIssue('');
                setCurrentEntry(null);
                setEntryNumber('');
                setCustomIssue('');
            };

            // Icons
            const CameraIcon = () => (
                <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M3 9a2 2 0 012-2h.93a2 2 0 001.664-.89l.812-1.22A2 2 0 0110.07 4h3.86a2 2 0 011.664.89l.812 1.22A2 2 0 0018.07 7H19a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V9z" />
                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M15 13a3 3 0 11-6 0 3 3 0 016 0z" />
                </svg>
            );

            const CheckIcon = () => (
                <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={3} d="M5 13l4 4L19 7" />
                </svg>
            );

            const ChevronIcon = () => (
                <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 5l7 7-7 7" />
                </svg>
            );

            const TrashIcon = () => (
                <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
                </svg>
            );

            // Screens
            if (screen === 'home') {
                return (
                    <>
                        <div className="header">Parts Tracker</div>
                        <div className="content">
                            <div className="btn-group">
                                <button className="btn btn-primary" onClick={() => { resetNewEntry(); setScreen('new'); }}>
                                    + New Entry
                                </button>
                                <button className="btn btn-success" onClick={() => { setSearchNumber(''); setScreen('search'); }}>
                                    Find Entry by Number
                                </button>
                                <button className="btn btn-light" onClick={() => setScreen('manage')}>
                                    Manage Issues
                                </button>
                            </div>
                            
                            {entries.length > 0 && (
                                <div style={{marginTop: '32px', padding: '16px', background: '#f9fafb', borderRadius: '12px', textAlign: 'center'}}>
                                    <div style={{fontSize: '14px', color: '#6b7280', marginBottom: '4px'}}>Total Entries</div>
                                    <div style={{fontSize: '32px', fontWeight: 'bold', color: '#2563eb'}}>{entries.length}</div>
                                </div>
                            )}
                        </div>
                    </>
                );
            }

            if (screen === 'new') {
                const canCreate = photo && selectedType && entryNumber && 
                    (selectedIssue && selectedIssue !== 'OTHER' || (selectedIssue === 'OTHER' && customIssue.trim()));
                
                return (
                    <>
                        <div className="header">New Entry</div>
                        <div className="content">
                            <div className="form-group">
                                <label>Entry Number</label>
                                <input
                                    type="text"
                                    value={entryNumber}
                                    onChange={(e) => setEntryNumber(e.target.value)}
                                    maxLength="4"
                                    placeholder="0001"
                                    style={{fontFamily: 'Courier New', fontSize: '18px', textAlign: 'center', fontWeight: 'bold'}}
                                />
                            </div>

                            <div className="form-group">
                                <label>Photo</label>
                                <input type="file" accept="image/*" capture="environment" id="photo-input" onChange={handlePhotoCapture} />
                                <label htmlFor="photo-input">
                                    <div className="photo-area">
                                        {!photo ? (
                                            <div className="photo-placeholder">
                                                <CameraIcon />
                                                <div>Tap to take photo</div>
                                            </div>
                                        ) : (
                                            <img src={photo} className="photo-preview" alt="Captured" />
                                        )}
                                    </div>
                                </label>
                            </div>

                            <div className="form-group">
                                <label>Item Type</label>
                                <select value={selectedType} onChange={(e) => { setSelectedType(e.target.value); setSelectedIssue(''); setCustomIssue(''); }}>
                                    <option value="">Select type...</option>
                                    {Object.keys(itemTypes).sort().map(type => (
                                        <option key={type} value={type}>{type}</option>
                                    ))}
                                </select>
                            </div>

                            {selectedType && (
                                <>
                                    <div className="form-group">
                                        <label>Issue</label>
                                        <select value={selectedIssue} onChange={(e) => { setSelectedIssue(e.target.value); if(e.target.value !== 'OTHER') setCustomIssue(''); }}>
                                            <option value="">Select issue...</option>
                                            {itemTypes[selectedType].map(issue => (
                                                <option key={issue} value={issue}>{issue}</option>
                                            ))}
                                            <option value="OTHER">Other (custom)</option>
                                        </select>
                                    </div>
                                    
                                    {selectedIssue === 'OTHER' && (
                                        <div className="form-group">
                                            <label>Custom Issue</label>
                                            <input
                                                type="text"
                                                value={customIssue}
                                                onChange={(e) => setCustomIssue(e.target.value)}
                                                placeholder="Type custom issue..."
                                            />
                                        </div>
                                    )}
                                </>
                            )}

                            <div className="btn-group">
                                <button className="btn btn-primary" disabled={!canCreate} onClick={handleCreateEntry}>
                                    Create Entry
                                </button>
                                <button className="btn btn-light" onClick={() => { resetNewEntry(); setScreen('home'); }}>
                                    Cancel
                                </button>
                            </div>
                        </div>
                    </>
                );
            }

            if (screen === 'created') {
                return (
                    <>
                        <div className="header">Entry Created</div>
                        <div className="content">
                            <div className="success-check">
                                <CheckIcon />
                            </div>
                            
                            <div className="number-display">
                                <div className="label">Print this number on your label:</div>
                                <div className="number">{currentEntry.number}</div>
                            </div>

                            <div className="detail-card">
                                <div className="detail-row">
                                    <span className="label">Type</span>
                                    <span className="value">{currentEntry.itemType}</span>
                                </div>
                                <div className="detail-row">
                                    <span className="label">Issue</span>
                                    <span className="value">{currentEntry.issue}</span>
                                </div>
                            </div>

                            <div className="btn-group">
                                <button className="btn btn-primary" onClick={() => { resetNewEntry(); setScreen('home'); }}>
                                    Done
                                </button>
                            </div>
                        </div>
                    </>
                );
            }

            if (screen === 'search') {
                return (
                    <>
                        <div className="header">Find Entry</div>
                        <div className="content">
                            <div className="search-container">
                                <input
                                    type="text"
                                    className="search-input"
                                    placeholder="Enter number (e.g. 0024)"
                                    value={searchNumber}
                                    onChange={(e) => setSearchNumber(e.target.value)}
                                    maxLength="4"
                                />
                            </div>

                            <div className="btn-group">
                                <button className="btn btn-success" disabled={!searchNumber} onClick={handleSearch}>
                                    Find Entry
                                </button>
                                <button className="btn btn-light" onClick={() => setScreen('home')}>
                                    Cancel
                                </button>
                            </div>
                        </div>
                    </>
                );
            }

            if (screen === 'detail') {
                return (
                    <>
                        <div className="header">Entry {currentEntry.number}</div>
                        <div className="content">
                            {currentEntry.photo && (
                                <div style={{marginBottom: '20px', borderRadius: '12px', overflow: 'hidden'}}>
                                    <img src={currentEntry.photo} style={{width: '100%', display: 'block'}} alt="Item" />
                                </div>
                            )}

                            <div className="detail-card">
                                <div className="detail-row">
                                    <span className="label">Number</span>
                                    <span className="value" style={{fontFamily: 'Courier New', fontSize: '18px'}}>{currentEntry.number}</span>
                                </div>
                                <div className="detail-row">
                                    <span className="label">Type</span>
                                    <span className="value">{currentEntry.itemType}</span>
                                </div>
                                <div className="detail-row">
                                    <span className="label">Issue</span>
                                    <span className="value">{currentEntry.issue}</span>
                                </div>
                                <div className="detail-row">
                                    <span className="label">Date Added</span>
                                    <span className="value">{new Date(currentEntry.createdAt).toLocaleDateString()}</span>
                                </div>
                            </div>

                            <div className="btn-group">
                                <button className="btn btn-danger" onClick={() => handleDelete()}>
                                    Delete (Item Parted Out)
                                </button>
                                <button className="btn btn-light" onClick={() => setScreen('home')}>
                                    Back to Home
                                </button>
                            </div>
                        </div>
                    </>
                );
            }

            if (screen === 'manage') {
                return (
                    <>
                        <div className="header">Manage Issues</div>
                        <div className="content">
                            <div className="manage-list">
                                {Object.keys(itemTypes).sort().map(type => (
                                    <div key={type} className="manage-item" onClick={() => { setEditingType(type); setScreen('edit-issues'); }} style={{cursor: 'pointer'}}>
                                        <span className="name">{type}</span>
                                        <span className="count">{itemTypes[type].length} issues</span>
                                        <ChevronIcon />
                                    </div>
                                ))}
                            </div>

                            <button className="btn btn-light" onClick={() => setScreen('home')}>
                                Back to Home
                            </button>
                        </div>
                    </>
                );
            }

            if (screen === 'edit-issues') {
                return (
                    <>
                        <div className="header">{editingType} Issues</div>
                        <div className="content">
                            <div className="add-issue-form">
                                <input
                                    type="text"
                                    placeholder="New issue..."
                                    value={newIssue}
                                    onChange={(e) => setNewIssue(e.target.value)}
                                    onKeyPress={(e) => e.key === 'Enter' && handleAddIssue()}
                                />
                                <button onClick={handleAddIssue}>Add</button>
                            </div>

                            <div className="issue-list">
                                {itemTypes[editingType].map((issue, idx) => (
                                    <div key={idx} className="issue-item">
                                        <span className="text">{issue}</span>
                                        <button onClick={() => handleDeleteIssue(editingType, issue)}>
                                            <TrashIcon />
                                        </button>
                                    </div>
                                ))}
                            </div>

                            <button className="btn btn-light" onClick={() => setScreen('manage')}>
                                Back
                            </button>
                        </div>
                    </>
                );
            }
        }

        ReactDOM.render(<App />, document.getElementById('root'));
    </script>
</body>
</html>